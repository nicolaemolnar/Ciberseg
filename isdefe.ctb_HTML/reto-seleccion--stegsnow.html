<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>stegsnow</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>stegsnow</h1><br/>The file containing the 4th flag is a `.txt`file, this means <em>steghide</em> will not be able to extract any files from it (as it is not an image). Anyway, if we have closer look at the contents of `flag4.txt`:<br /><div class="codebox"><pre>alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ <span style="color:#ff9d00;font-weight:700">cat</span> flags<span style="color:#ff9d00;font-weight:700">/</span>flag4.txt <br />flag<span style="color:#ff9d00;font-weight:700">{</span>este_es_casi_el_final<span style="color:#ff9d00;font-weight:700">}</span><br /><br /><br /><br /><br /><br /><br /><br /><br />alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$</pre></div><br /><br />We can notice that the plain text is not the only information stored in this file, so we can assume there is something hidden in the blank characters found in the file. To make sure that we are right, we are going to run a `hexedit` against the file and see the ascii output:<br /><a href=""><img src="images/18-1.png" alt="images/18-1.png" /></a><br /><br />We can see that the <em>hexdump</em> of the file is irregular, to be sure we can compare it with a new file which contains only the text and 5 ‘\n’s:<br /><a href=""><img src="images/18-2.png" alt="images/18-2.png" /></a><br /><br />There is an obvious difference between the two outputs, so we are sure there is something hidden in that dot grid. After researching about ways to hide files or data in .txt using spaces and tabulations we discovered <em><strong>snow</strong></em> a steganographic program capable of embedding complete files inside .txt, .docx, etc. files. We download the program <em><strong>stegsnow</strong></em> from the linux apt repository and run some tests on the test file we created:<br /><div class="codebox"><pre>alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ stegsnow -p <span style="color:#3ad900;font-weight:400">&quot;test&quot;</span> -m <span style="color:#3ad900;font-weight:400">&quot;Hi&quot;</span> flag_test.txt flag_hidden.txt <br />Message used approximately 20.51% of available space.<br />alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ <span style="color:#ff9d00;font-weight:700">cat</span> flag_hidden.txt <br />flag<span style="color:#ff9d00;font-weight:700">{</span>este_es_casi_el_final<span style="color:#ff9d00;font-weight:700">}</span><br /><br /><br /><br />alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ </pre></div><br /><br /><a href=""><img src="images/18-3.png" alt="images/18-3.png" /></a><br /><br />Success!!! We inserted the message <em>Hi</em> in the file `flag_hidden.txt` and, as we can see, the output obtained is similar to the file extracted with `steghide`. The point is that `stegsnow`, as well as `steghide`, requires a passphrase to embed or extract files or messages. Let&#39;s give it a try with an empty passphrase:<br /><div class="codebox"><pre>alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ stegsnow -p <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> flags<span style="color:#ff9d00;font-weight:700">/</span>flag4.txt <br />Warning<span style="color:#ff9d00;font-weight:700">:</span> an empty password is being used<br /><span style="color:#333333;font-weight:400">\&#39;</span>xK<br />    <span style="color:#ff9d00;font-weight:700">{</span>krٌi<span style="color:#3ad900;font-weight:400">&quot;vR#alex@DESKTOP-MQKMDU5:/mnt/c/Ciberseg/reto_seleccion$ </span></pre></div><br /><br />The passphrase ended up in failure, but not completely, the fact that the extraction give us some output demonstrates that there is some message hidden, but the passphrase was not correct.<br />Up to this point we can follow two paths, trying to guess the password with information found in the previous steps or running bruteforce against the file to try to find the passphrase.<br />1. Let&#39;s try to guess the passphrase with the information gathered up to now:<br /> 	- <em><strong>isdefe</strong></em> (name of the organisation that hosts the challenge page) - Failure 	<br /> 	- <em><strong>stego</strong></em> (from flag3.jpeg) - Failure<br /> 	- <em><strong>steganography</strong></em> - Failure<br /> 	- <em><strong>snow</strong></em> (the stego program) - Failure<br /> 	- <em><strong>geronimo.malware</strong></em> (from flag.pcapng) - Failure<br /> 	- <em><strong>geronimo</strong></em> - Failure<br /> 	- <em><strong>malware</strong></em> - Failure<br /> 	- <em><strong>flag{este_es_casi_el_final}</strong></em> (last known flag) - Failure<br /> 2. Let&#39;s run a simple python program to try to crack the passphrase. To do this, we could use a popular wordlist within brute forcing, <em><strong>rockyou.txt</strong></em>, the callback is that this file has 1.435.000 combinations and lots of time to analyze them all. Instead we will use a custom wordlist with words from ‘a’ to  ‘zzzzzzzz’, because the rest of the flags where easy to capture and we assume that, if there is a passphrase, it must be shorter than 8 characters.<br /> 	- First, create the wordlist with the script <em><strong>dic_creator.py</strong></em> obtained from github.<br /> 	- Second, run the script <em><strong>snow_decrypt.py</strong></em> against the <em><strong>flag4.txt</strong></em> file and try to extract the file.<br /> 	- We left the script running tests while continuing investigating other paths to follow.<br /> <div class="codebox"><pre> alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ python3 scripts<span style="color:#ff9d00;font-weight:700">/</span>snow_decrypt.py <br />Trying with<span style="color:#ff9d00;font-weight:700">:</span>        dn8, tried<span style="color:#ff9d00;font-weight:700">:</span> 17343 times.</pre></div><br /><br /> After a deeper research on the <em><strong>stegsnow</strong></em> program use, we discovered that in some unusual cases you can use the program to extract without the <em><strong>-p</strong></em> argument: <em><strong>stegsnow flags/flag4.txt</strong></em>, let&#39;s try it:<br /> <div class="codebox"><pre>alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ stegsnow flags<span style="color:#ff9d00;font-weight:700">/</span>flag4.txt <br />flag<span style="color:#ff9d00;font-weight:700">{</span>este_es_el_verdadero_final<span style="color:#ff9d00;font-weight:700">}</span>alex@DESKTOP-MQKMDU5<span style="color:#ff9d00;font-weight:700">:/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>c<span style="color:#ff9d00;font-weight:700">/</span>Ciberseg<span style="color:#ff9d00;font-weight:700">/</span>reto_seleccion$ </pre></div><br />Success!! The last step is to redirect the output of the execution:<br /><div class="codebox"><pre>stegsnow flags<span style="color:#ff9d00;font-weight:700">/</span>flag4.txt &gt; flags<span style="color:#ff9d00;font-weight:700">/</span>flag5.txt</pre></div><br />and we solved the challenge to the final flag.<br /> <br /><br /></div>
</body>
</html>
